<link rel="import" href="../../libs/polymer/polymer.html"/>
<link rel="import" href="dl-alert.html"/>

<polymer-element name="dl-button-pag-seguro" attributes="code">
    <template>
        <!--####################################################################################-->

        <input id="checkTermsOfUse"
               type="checkbox"/>

        <a id="linkTermsOfUse">Li e aceito os <span class="underline">termos de uso</span></a>

        <!--####################################################################################-->

        <form id="formPagSeguro"
              target="pagSeguro"
              action="https://pagseguro.uol.com.br/checkout/v2/payment.html"
              method="post">

            <!--################################################################################-->

            <input type="hidden"
                   name="code"
                   value="{{code}}"/>

            <!--################################################################################-->

            <dl-alert id="alertTermsOfUse"
                      style="display: none;"
                      type="warn">
                Você precisa concordar com os termos de uso
            </dl-alert>

            <div class="button-container">
                <input id="buttonBuyNow"
                       type="submit"
                       name="submit"
                       class="button"
                       alt="Pague com PagSeguro - é rápido, grátis e seguro!"
                       value="COMPRAR AGORA"/>
            </div>

            <!--################################################################################-->

            <div class="payWith">
                <span>Pague com</span>
                <img src="../../images/pag-seguro.png"
                     alt="Pague com PagSeguro - é rápido, grátis e seguro!"/>
            </div>

            <!--################################################################################-->

        </form>

        <!--####################################################################################-->
    </template>

    <!--########################################################################################-->

    <script>
        Polymer("dl-button-pag-seguro", {
            ready: function() {
                var self = this;
                self.$.linkTermsOfUse.addEventListener('click', function() {
                    self.readTermsOfUse(self);
                });
                self.$.buttonBuyNow.addEventListener('click', function() {
                   self.buyNow(self);
                });
                self.$.formPagSeguro.addEventListener('submit', function(event) {
                    if (!self.isValid(self)) {
                        event.preventDefault();
                    }
                });
            },
            isValid: function(context) {
               return context.$.checkTermsOfUse.checked;
            },
            readTermsOfUse: function(context) {
                context.openWindow("terms-of-use.html", "terms-of-use");
            },
            buyNow: function(context) {
                if (context.isValid(context)) {
                    context.$.alertTermsOfUse.style.display = "none";
                    context.openWindow("", "pagSeguro");
                } else {
                    context.$.checkTermsOfUse.focus();
                    context.$.alertTermsOfUse.style.display = "block";
                }
            },
            openWindow: function(url, target) {
                window.open(url, target, "toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no");
            }
        });
    </script>
</polymer-element>